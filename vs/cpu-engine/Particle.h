#pragma once

struct PARTICLE_PHYSICS
{
	float gx;
	float gy;
	float gz;
	float drag;					// 0.. (ex: 1..5)
	float maxSpeed;				// 0 = no clamp

	float minX;
	float minY;
	float minZ;
	float maxX;
	float maxY;
	float maxZ;
	bool useBounds;
	float bounce;				// 0..1

	PARTICLE_PHYSICS();
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct PARTICLE_DATA
{
	int maxCount = 0;
	int alive = 0;

	float* px = nullptr;
	float* py = nullptr;
	float* pz = nullptr;

	float* vx = nullptr;
	float* vy = nullptr;
	float* vz = nullptr;

	float* age  = nullptr;
	float* duration = nullptr;
	ui32* seed = nullptr;

	float* r = nullptr;
	float* g = nullptr;
	float* b = nullptr;

	PARTICLE_DATA();
	~PARTICLE_DATA();

	void Create(int maxP);
	void Destroy();
	void Update(float dt, const PARTICLE_PHYSICS& phys);
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct PARTICLE_EMITTER
{
	int index;
	int sortedIndex;
	bool dead;

	float rate; // particles/sec
	float accum;
	float durationMin;
	float durationMax;

	PARTICLE_EMITTER();
	void Update(PARTICLE_DATA& p, float dt, float ox, float oy, float oz, float baseVx, float baseVy, float baseVz, float r, float g, float b);
};
