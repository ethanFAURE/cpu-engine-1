#include "pch.h"

cpu_texture::cpu_texture()
{
	bgra = nullptr;
	Close();
}

cpu_texture::~cpu_texture()
{
	Close();
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

bool cpu_texture::Load(const char* path)
{
	Close();

	int filesize;
	byte* data = cpu::LoadFile(path, filesize);
	if ( data==nullptr )
		return false;

	int w, h;
	byte* buf = cpu_png32::Load(data, filesize, &w, &h);
	delete [] data;
	if ( buf==nullptr )
		return false;

	bgra = buf;
	width = w;
	height = h;
	count = width * height;
	size = count * 4;

	for ( int i=0 ; i<size ; i+=4 )
	{
		byte r = bgra[i];
		bgra[i] = bgra[i+2];
		bgra[i+2] = r;
	}
	cpu_img32::Premultiply(bgra, bgra, width, height);
	return true;
}

void cpu_texture::Close()
{
	CPU_DELPTRS(bgra);
	width = 0;
	height = 0;
	count = 0;
	size = 0;
}
